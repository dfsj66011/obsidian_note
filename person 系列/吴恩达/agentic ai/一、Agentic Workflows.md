
## 1、Welcome

欢迎来到这门关于自主人工智能的课程。当我创造"自主"这个词来描述我所观察到的一个重要且快速发展的趋势——人们如何在基础应用上进行构建时，我没想到的是，一群营销人员会抓住这个词，把它当作标签贴到几乎所有能看到的东西上。这导致关于自主人工智能的炒作急剧升温。

不过好消息是，抛开炒作不谈，真正有价值且实用的智能代理 AI 应用数量也在飞速增长，尽管增速可能不及炒作那么夸张。在这门课程中，我将向您展示构建智能代理 AI 应用的最佳实践。这将为您打开许多新的可能性，拓展您可构建的应用范围。

如今，智能代理工作流正被用于构建各类应用，例如客服代理、开展深度研究以撰写富有洞察力的研究报告、处理复杂的法律文件，或是分析患者输入信息并提出可能的医疗诊断建议。在我参与的许多团队中，如果没有自主工作流程，我们构建的很多项目根本无法实现。因此，掌握如何利用它们构建应用程序，是当今人工智能领域最重要且最有价值的技能之一。

事实证明，我观察到真正擅长构建智能体工作流的人与效率较低者之间最大的区别之一，在于能否推动一个严谨的开发流程——尤其是专注于评估和错误分析的流程。在这门课程中，我将为你解读其中的含义，并展示如何真正精通构建这些智能体工作流。掌握这项技能是当今人工智能领域最重要的能力之一，它将为你打开更多机遇之门——无论是职业发展机会，还是自主开发卓越软件的契机。接下来，让我们进入下一个视频，更深入地探讨什么是智能体工作流。


## 2、What is Agentic AI

那么什么是 Agentic AI？为什么 Agentic AI 的工作流程如此强大？让我们来看看。如今，我们许多人使用大型语言模型（LLMs）的方式是通过提示它，比如让它为我们写一篇关于某个特定主题 X 的文章。

我认为这就像让一个人，或者在这里的情况下，让 AI 一次性从头到尾打出一篇文章，而且不能使用退格键。事实证明，我们人类在被迫以这种完全线性的方式写作时，也无法发挥出最佳水平，AI 模型也是如此。然而，尽管受限于这种写作方式存在困难，我们的大语言模型却表现得出奇地好。

相比之下，在自主工作流程中，整个过程可能是这样的：你可以先让它就某个主题撰写一篇论文提纲，然后询问它是否需要进行网络调研。在进行一些网络调研并可能下载一些网页后，开始撰写初稿，然后阅读初稿，看看哪些部分需要修改或进一步研究，接着修改草稿，如此反复。

而这种工作流程更像是先进行一些思考和研究，然后做一些修改，接着再进行更多的思考，如此循环往复。通过这种迭代过程，我们发现，虽然代理式工作流程可能需要更长的时间，但它能产出一个质量高得多的工作成果。

因此，一个自主 AI 工作流程是指基于大语言模型（LLM）的应用程序执行多个步骤以完成任务的过程。在这个例子中，你可能会先用 LLM 来撰写论文的第一份提纲，然后再用 LLM 来决定在网页搜索引擎中输入哪些搜索词，或者更准确地说，调用网页搜索 API 时应使用哪些搜索词，以便获取相关的网页内容。

基于此，您可以将下载的网页内容输入大语言模型（LLM）来生成初稿，然后或许再用另一个 LLM 进行反思并决定哪些部分需要进一步修改。根据您设计的工作流程，甚至可能加入人工审核环节，让 LLM 可以选择请求人工复核某些关键事实。

在此基础上，它可能会修改草稿，这一过程最终会产生更好的工作成果。在这门课程中，你将学习到的一项关键技能是如何将复杂的任务（如撰写论文）分解为更小的步骤，以便代理工作流程逐步执行，最终获得你想要的工作成果。

而懂得如何将任务分解为步骤，以及如何构建组件来很好地执行各个步骤，最终成为一项棘手但至关重要的技能，这将决定你能否为各种令人兴奋的应用构建自动化工作流程。

在本课程中，我们将使用一个贯穿始终的示例，并让你与我一起构建一个研究助手。以下是一个示例展示。你可以输入一个研究主题，比如"如何创办一家新的火箭公司与 SpaceX 竞争"。我个人并不想与 SpaceX 竞争，但如果你想这样做，可以尝试让研究助手帮助你进行背景调研。

于是这个智能体首先规划要使用哪些研究资料，包括调用网络搜索引擎下载一些网页，然后综合并排序调研结果，起草大纲，由编辑型智能体审核内容的连贯性，最后生成一份全面的 Markdown 格式报告——正如我们眼前这份：它构建了一家对标 SpaceX 的新型火箭公司方案，包含简介、背景、调研发现等完整章节。

我认为它恰当地指出这将是一个难以建立的初创项目，所以我个人并不打算这么做。但如果你想尝试类似的事情，也许像这样的研究助手可以在初期研究中帮到你。通过查找和下载多种资料并深入思考，最终得到的报告会比直接让大语言模型为你写一篇文章要深思熟虑得多。

我对此感到兴奋的原因之一是，在我的工作中，我最终构建了许多专业的研究代理，无论是在法律文件中用于冲突法律合规，还是在一些医疗保健领域，或是一些商业产品研究领域。

因此，我希望通过这个例子，你不仅能学会如何为许多其他应用构建代理工作流，而且如果你需要自己构建一个定制的研究代理，构建研究代理的一些想法将对你直接有用。

现在，人工智能代理经常讨论的一个领域是它们有多自主？你刚才看到的是一种相对复杂、高度自主的智能体 AI 工作流程，但还有其他一些更简单却极具价值的工作流程。让我们继续观看下一个视频，讨论智能体工作流程可以实现多大程度的自主性，以及它是否为你提供了一个框架，来思考如何构建不同的应用程序，以及它们的难易程度。下个视频见。

## 3、Degrees of autonomy

智能体可以具有不同程度的自主性。几年前，我注意到人工智能界内部就"什么是智能体"展开了日益激烈的争议，有些人发表论文声称自己构建了一个智能体，而另一些人则会反驳说那并非真正的智能体。我觉得这场辩论毫无必要，正因如此我才开始使用 "agentic" 这个术语。

我认为，如果我们将其视为一个程度形容词而非二元标签——要么具有主体性要么没有——那么我们就必须承认，系统可以具有不同程度的能动性。与其争论"这个系统是否足够自主到能被称为主体"，不如直接统称它们都具有能动性，把精力集中在真正重要的工作——构建这些系统本身上。 

我记得当我准备一个关于主体性推理的演讲时，我的一个团队成员真的来找我说，嘿，Andrew，我们不需要再有一个新词了。你知道，我们已经有agent（代理）这个词了，你为什么还要造一个新词 agentic（主体性的）呢？但我还是决定使用它。后来，我在一份名为《The Batch》的通讯中写了一篇文章，并在社交媒体上发布，说与其争论哪些词应该被包括或排除作为真正的代理，不如承认系统可以具有不同程度的代理性。

我认为这有助于超越关于什么是真正智能体的争论，让我们能够专注于实际构建它们。有些智能体的自主性可以较低。以撰写一篇关于黑洞的文章为例，你可以用一个相对简单的智能体来生成一些网络搜索词或搜索查询。然后你可以硬编码调用一个网络搜索引擎，获取一些网页，然后用这些信息来写一篇文章。这就是一个自主性较低的代理程序的例子，它完全按照确定的步骤顺序执行。这样效果还不错。

在符号约定方面，在本课程中，我会使用红色，就像你在这里左边看到的，来表示用户输入，比如在这个例子中的用户查询，或者在后面的例子中，可能是输入到代理工作流程中的文档。

灰色方框表示对大型语言模型（LLM）的调用，而绿色方框（如您在此处看到的网络搜索和网页抓取方框）则代表使用其他软件执行操作的步骤，例如调用网络搜索 API 或执行代码以获取网站内容。那么，一个代理可以更加自主，比如在接到撰写一篇关于黑洞的文章的请求时，或许你可以让大语言模型自行决定：它是想进行网页搜索，还是想搜索最近的新闻来源，又或是想在网站档案中查找最新的研究论文？

基于此，在这个例子中，可能是大语言模型（LLM）而非人类工程师决定调用网络搜索引擎，之后可能让 LLM 自行决定需要抓取多少网页，或者如果抓取的是 PDF 文件，是否需要调用某个函数或工具来将 PDF 转换为文本。

在这种情况下，它可能会先获取排名靠前的几个网页，然后撰写一篇文章，决定是否进行反思和改进，甚至可能返回去获取更多网页，最终生成输出内容。因此，即使以这个研究代理的例子来看，我们也能发现，有些代理的自主性较低，执行的是程序员预先确定的线性步骤序列；而有些代理则更具自主性，你可以信任大语言模型做出更多决策，具体的步骤序列甚至可能由大语言模型而非程序员提前决定。

因此，对于自主性较低的系统，通常所有步骤都是预先确定的，它调用的任何功能（如网络搜索，我们称之为工具使用，正如你在本课程第三模块中学到的）可能是由人类工程师（你或我）硬编码的，而大部分自主性体现在 LLM 生成的文本上。

在光谱的另一端是高度自主的智能体，它们能够自主做出许多决策，例如决定撰写文章时需要遵循的具体步骤顺序。还有一些高度自主的智能体，它们甚至能编写新功能，有时还能创建可执行的新工具。介于两者之间的是半自主智能体，它们能做出一些决策、选择工具，但这些工具通常都是预先定义好的。

在本课程中，当你观察不同的案例时，你会学习如何构建从低自主性到高自主性这一范围内的应用程序。你会发现，在自主性较低的一端，有许多为当今众多企业构建的极具价值的应用；与此同时，在自主性较高的一端，也有一些正在开发中的应用，但这些应用通常较难控制，稍显不可预测，并且还需要大量积极的研究来探索如何构建这些高度自主的智能体。

那么，接下来让我们进入下一个视频，更深入地探讨这个话题，了解使用代理的一些好处，以及为什么它们能让我们做到早期基础应用程序根本无法实现的事情。

## 4、Benefits of agentic AI

我认为智能代理工作流最大的优势在于，它能让你高效完成许多过去根本无法实现的任务。但除此之外，它还具有其他优势：并行处理能力让你能极速完成特定操作，模块化设计则允许你整合来自不同领域的最优组件，从而构建高效的工作流程。让我们具体来看看。

我的团队收集了一些关于编码基准测试的数据，该测试评估了不同大型语言模型（LLM）编写代码以完成特定任务的能力。本次使用的基准测试名为HumanEval。结果显示，GPT 3.5（即第一版公开 ChatGPT 所基于的模型）如果被要求直接编写代码、完整输出计算机程序，在该基准测试中的正确率为 40%。这是一个 positive k-metric。

GPT4 是一个更优秀的模型。在这种非代理工作流程下，其性能跃升至 67%。但事实证明，尽管从 GPT3.5 到 GPT4 的改进幅度很大，这种改进与将 GPT3.5 嵌入代理工作流程所能实现的提升相比，仍显得相形见绌。

通过运用不同的代理技术（你将在本课程后续内容中学习到），你可以引导 GPT3.5 编写代码，然后可能对代码进行反思，思考是否可以改进。通过使用这些技术，你实际上可以让 GPT3.5 达到更高水平的性能。同样地，在代理工作流程中使用 GPT4 也能取得更好的效果。

因此，即便使用目前最先进的大语言模型，采用代理式工作流程仍能显著提升性能。事实上，在这个例子中我们发现，模型升级带来的巨大改进，仍比不上在前代模型上实施代理式工作流程所产生的提升幅度。

使用代理工作流的另一个好处是，它们可以并行处理某些任务，因此比人类更快地完成某些事情。例如，如果你让一个代理工作流写一篇关于黑洞的文章，你可以让三个 LLM 并行运行，生成用于搜索引擎的搜索词的想法。根据第一次网络搜索，它可能会识别出三个要获取的顶级结果。根据第二次网络搜索，它可能会识别出第二组要获取的网页，以此类推。

事实证明，人类进行这项研究需要依次或逐一阅读这九个网页，而当你采用智能代理工作流时，实际上可以并行下载所有九个网页，最后将这些内容输入大语言模型来撰写文章。

因此，尽管代理工作流程确实比真正的非代理工作流程或仅通过单次提示直接生成需要更长的时间，但如果你将这种类型的代理工作流程与人类完成任务的方式进行比较，并行下载大量网页的能力实际上可以让它在某些任务上比人类单线程顺序处理数据的方式快得多。

在这个例子的基础上，我发现构建代理工作流时，我经常做的一件事就是查看各个组件（如大语言模型），然后添加或替换组件。例如，我可能会查看这里使用的网络搜索引擎，并决定想要换一个新的网络搜索引擎。

在构建自主工作流程时，实际上有多种网络搜索引擎可供选择，包括可通过服务器访问的谷歌，以及必应、DuckDuckGo、Tavily、u.com 等其他引擎。实际上，专为大型语言模型设计的网络搜索引擎选项相当丰富。或者，与其只进行三次网络搜索，也许在这一步我们可以换用一个新的新闻搜索引擎，这样就能了解黑洞科学最新突破的相关新闻。

最后，我不会在所有步骤中都使用同一个大语言模型，而是经常尝试不同的大语言模型，甚至可能尝试不同的大语言模型供应商，看看哪个模型在这个系统的不同步骤中能给出最佳结果。总结来说，我使用代理工作流的主要原因是，它在许多不同的应用中都能提供更好的性能。

但除此之外，它还能将一些原本需要人类按顺序完成的任务自动化。许多代理工作流的模块化设计也让我们能够添加或更新工具，有时还能更换模型。我们已经详细讨论了构建代理工作流的关键组件。现在，让我们来看一系列代理人工智能应用，让你了解人们已经在构建的东西，以及你自己将要构建的东西。让我们继续观看下一个视频。

## 5、Agentic AI applications

让我们来看一些自主人工智能应用的实际案例。许多企业都需要处理发票业务。比如面对这样一张发票，你可能需要开发软件来提取关键字段——在这个案例中，我们需要提取收款方（这里是 TechFlow Solutions 公司）、收款方地址、应付金额（3000 美元）以及到期日（显示为 2025年8月20日）。因此在许多财务部门中，可能需要由人工查看发票并识别最重要的字段——我们需要在何时向谁付款，然后将这些信息记录到数据库中，以确保及时付款。

如果要通过智能代理工作流来实现这一点，可以按照以下步骤操作：先输入发票信息，然后调用 PDF 转文本的 API 将 PDF 转换为格式化文本（例如便于大语言模型处理的 Markdown 文本）。

然后，大语言模型会查看 PDF 文件并判断：这确实是一张发票，还是应该忽略的其他类型文件？如果是发票，它将提取必填字段，并通过 API 或工具更新数据库，以便将最重要的字段存入数据库记录中。这种代理工作流的一个特点是：存在明确的流程可循，即识别必填字段并录入数据库。这类有明确流程的任务可能更适合由代理工作流来执行，因为它能提供一种相对逐步可靠完成任务的方式。

再举一个稍微复杂一点的例子。如果你想构建一个代理来回应基本的客户订单查询，那么步骤可能是提取关键信息，比如弄清楚客户具体订购了什么、客户的名字是什么，然后查找相关的客户记录，最后在邮件回复发送给客户之前，起草一份回复供人工审核。

因此，这里有一个明确的流程，我们将逐步实施：接收邮件后，将其输入大型语言模型（LLM）进行验证或提取订单详情。如果客户邮件涉及订单，LLM随后可能会调用订单数据库来调取相关信息。这些信息随后会被输入到 LLM（大语言模型）中，由其起草一封回复邮件。 LLM 可能会选择使用一个请求审核工具，比如将这份由 LLM 生成的邮件草稿放入队列等待人工审核，这样在人工审核并批准后，邮件就可以发送出去了。如今，类似这样的客户订单查询代理系统正在许多企业中被构建和部署。

来看一个更具挑战性的例子：如果你想构建一个客服代理，不仅能回答客户关于订单的问题，还能应对更广泛的各种提问，包括客户可能提出的任何问题，比如“你们有黑色牛仔裤或蓝色牛仔裤吗？” 要回答这个问题，你可能需要向数据库发起多个 API 调用，先检查黑色牛仔裤的库存，再检查蓝色牛仔裤的库存，然后才能回复客户。这就是一个更具挑战性的查询示例，在给定用户输入的情况下，你实际上需要规划出检查库存的数据库查询顺序。

或者如果用户问：“我想退回我买的沙滩巾”，那么要回答这个问题，我们可能需要核实客户确实购买了一条沙滩巾，然后再次确认退货政策。也许我们的退货政策规定只能在购买后 30 天内退货，而且毛巾必须未使用过。如果允许退货，则让代理出具退货装箱单，并将数据库记录设置为待退货状态。因此，在这个例子中，如果处理客户请求所需的步骤事先未知，就会导致一个更具挑战性的过程，基于 LLM 的应用程序必须自行决定这三个步骤，以便对此任务做出适当的响应。

但你也会了解到一些关于如何解决这类问题的最新研究。再举一个可能特别难构建的智能体例子，有很多关于智能体使用计算机的研究，这些智能体会尝试使用网络浏览器阅读网页，以弄清楚如何完成一项复杂的任务。

在这个例子中，我让一个代理检查从旧金山飞往华盛顿特区（DCA 机场）的两班美联航航班是否有空位。该代理可以使用网络浏览器来完成这项任务。在视频中，你可以看到它独立操作美联航网站，点击页面元素并填写文本字段，以执行我请求的搜索。

在运行过程中，该智能代理会对页面内容进行推理分析，以确定完成任务所需的操作步骤及后续行动。在本案例中，它在联合航空官网查询航班时遇到问题，于是转而跳转到 Google Flights 网站搜索可用航班。

在 Google Flight 上，你可以看到这里找到了几个符合用户查询的航班选项，然后代理选择了一个，并被带回到 United 网站，看起来现在是在正确的网页上，因此能够确认，是的，我询问的航班上有座位可用。

因此，计算机应用目前是一个令人兴奋的前沿研究领域，许多公司正致力于开发能有效运作的计算机应用代理。虽然您刚才看到的代理最终找到了答案，但我经常发现代理在使用网页浏览器时表现不佳。例如，当网页加载缓慢时，代理可能无法理解当前状况，而且许多网页内容仍超出代理准确暂停或读取的能力范围。

但我认为，计算机使用代理（尽管目前在关键任务应用中还不够可靠）是未来发展中令人兴奋且重要的领域。因此，当我考虑构建代理式 AI 工作流时，那些更容易的任务往往是有明确分步流程的任务，或者企业已经有一个标准程序、一个标准的执行流程可以遵循。然后，将这些流程编码到 AI 代理中可能需要大量工作，但这往往会导致更容易的实现。

如果只使用纯文本资源，事情会简单一些，因为语言模型（LLM）主要擅长处理文本。如果需要处理其他类型的输入，虽然也是可行的，但可能会稍微复杂一点。

而在难度较高的一端，如果事先不知道完成任务所需的步骤，就像你在更高级的客户服务专员那里看到的那样，那么专员可能需要在执行过程中进行规划或解决问题，这往往更加困难、更不可预测且可靠性较低。

如前所述，如果系统需要处理声音、视觉、音频等多模态输入，其可靠性往往不如仅处理文本的流程。希望这些分析能帮助你理解如何运用智能体工作流来构建各类应用。在自行实施这类系统时，最关键的能力是将复杂流程拆解为独立步骤，从而设计出能逐步执行这些步骤的智能体工作流。

在下一个视频中，我们将讨论任务分解，也就是说，当你面临一项复杂的任务时，比如撰写研究报告或让客服代理回复客户，如何将其分解为离散的步骤，以实现代理工作流程？让我们在下一个视频中一探究竟。

## 6、Task Decomposition

人和企业会做很多事情。如何将这些有用的行为分解为独立的步骤，以便智能工作流遵循？让我们来看一个例子，比如构建一个研究代理。如果你想让 AI 系统撰写一篇关于 X 主题的文章，一种方法是直接提示大型语言模型（LLM）生成内容。但如果你希望针对需要深入研究的主题这样做，可能会发现 LLM 的输出仅涉及表面层次的观点，或者只涵盖显而易见的事实，而没有像你希望的那样深入探讨该主题。

在这种情况下，你可能会思考作为人类会如何撰写一篇关于某个主题的文章。你会直接坐下来开始写作，还是会采取多个步骤，比如先写一个文章大纲，然后搜索相关资料，再根据网络搜索的结果来撰写文章。

当我接手一项任务并将其分解为多个步骤时，我常常会问自己一个问题：如果逐一审视这些步骤一、二和三，其中每一步是否都能通过大语言模型（LLM）、一小段代码、函数调用或工具来完成。在这种情况下，我认为大语言模型或许能就许多我希望它帮我梳理的主题，写出一个不错的提纲。

所以，第一步可能还行，然后我知道如何使用大语言模型生成搜索词来搜索网页。因此，我认为第二步也是可行的，然后基于网页搜索，我认为大语言模型可以输入网页搜索结果并撰写一篇文章。因此，这将是一个合理的初步尝试，用于构建一个比直接生成更深入的代理式文章写作流程。

但如果我随后实施这种自主工作流程并查看结果，你可能会发现结果仍然不够理想。它还不够深思熟虑。也许文章感觉有点支离破碎。这实际上发生在我身上。我曾经用这种工作流程构建了一个研究代理，但当我阅读输出时，感觉有点不连贯。

你知道，文章的开头与中间部分不太一致，结尾也不太连贯。在这种情况下，你可以思考一下，如果作为人类发现文章有点脱节，你会如何改变工作流程。你可以做的一件事是采取第三步，进一步分解，将文章写作分成更多的步骤。

因此，与其一口气写完文章，不如先让它写出初稿，然后考虑哪些部分需要修改，再对草稿进行修订。这也是我作为人类可能会采取的方式，不会在第一次尝试时就写出最终的文章，而是先写出初稿，再通读一遍——这是大型语言模型（LLM）相当擅长的另一个步骤。

然后，根据我对自己文章的自我批评，我会修改草稿。总结一下，我一开始是直接生成，只有一步，后来觉得不够好，于是把它分解成三步，然后又觉得可能还是不够好，就把其中一步进一步分解或拆解成更多的三步，最终形成了这个更复杂、更丰富的文章生成过程。根据你对这一过程结果的满意程度，你甚至可以选择进一步修改这个文章生成流程。

让我们来看第二个例子，了解如何将复杂任务分解为更小的步骤。以处理基本客户订单查询为例。人类客户专员可能会采取的第一步是提取关键信息，比如这封邮件来自谁、他们订购了什么以及订单号是多少。这些都是大型语言模型（LLM）可以完成的任务。因此，我可以说，让 LLM 来处理这部分工作。

第二步则是查找相关的客户记录。因此，编写并生成相关的数据库查询，以提取客户订购的内容、发货时间等信息。我认为，具备调用函数查询订单数据库能力的大型语言模型应该能够做到这一点。

最后，在提取客户记录或客户订单记录后，我可能会编写并发送回复给客户。我认为，根据我们收集的信息，如果提供调用 API 发送邮件的选项，第三步也是可以通过大型语言模型（LLM）实现的。

这将是另一个例子，展示如何将回复客户邮件的任务分解为三个独立步骤。我可以逐一审视这些步骤并确认：是的，我认为一个 LLM，或者一个具备调用函数查询数据库或发送邮件能力的 LLM，应该能够完成这些任务。

关于发票处理的最后一个例子。在将 PDF 发票转换为文本后，第一步是提取所需信息：开票人姓名、地址、到期日、应付金额等。现在我应该能够做到这一点。然后，如果我想检查信息是否被提取并保存到一个新的数据库条目中，我认为 LLM 应该能够帮助我调用一个函数来更新数据库记录。因此，为了实现这一点，我们实施了一个代理工作流程，基本上执行这两个步骤。

在构建代理工作流程时，我认为自己拥有一些构建模块。其中一个重要的构建模块是大型语言模型，或者如果我想要处理图像或音频的话，也可能是大型多模态模型。而大语言模型擅长生成文本、决定调用什么功能，或许还能提取信息。

对于一些高度专业化的任务，我可能还会使用其他一些 AI 模型，比如将 PDF 转换为文本的 AI 模型、文本转语音模型或图像分析模型。除了 AI 模型，我还能使用多种软件工具，包括可以调用的不同 API，用于语音搜索、获取实时天气数据、发送邮件、查看日历等等。

我也可能拥有检索信息的工具，可以从数据库中提取数据，或者发明 RAG（检索增强生成）技术，让我能够查阅大型文本数据库并找到最相关的文本。我还可能拥有执行代码的工具。这是一种让大型语言模型编写代码，然后在你的计算机上运行代码以完成各种任务的功能。

如果这些工具中有一些对你来说有点陌生，别担心。我们会在后面的模块中更详细地介绍最重要的工具。但我在构建代理工作流程时，常常会思考个人或企业正在做的工作，然后尝试用这些构建模块来设计如何将它们按顺序组合在一起，以完成我希望系统执行的任务。

这就是为什么充分了解可用的构建模块非常重要——我希望在本课程结束时你也能对此有更清晰的认识——这将帮助你更好地设想如何通过组合这些构建模块来构建智能工作流程。总结来说，构建智能工作流程的关键技能之一，就是观察人们可能执行的某些任务，并识别出可以用离散步骤来实现的具体环节。

当我审视每一个独立的步骤时，我常常会问自己一个问题：这一步是否可以通过大型语言模型（LLM）或其他工具（如 API 或函数调用）来实现？如果答案是否定的，我通常会接着思考：如果是人类，会如何完成这一步？那么，是否有可能进一步分解这个任务，或者将其拆分成更小的步骤，这样也许更适合用大型语言模型（LLM）或我手头的某个软件工具来实现？希望这能让你对任务分解的思路有个大致的了解。

如果你觉得自己还没有完全掌握，别担心。本课程中我们会通过更多例子来讲解，到课程结束时你会对这部分内容有更深入的理解。但事实证明，在构建智能体工作流的过程中，你往往会先建立一个初步的任务分解和初始工作流，然后需要多次迭代优化，直到它达到你期望的性能水平。

为了推动这一改进过程（我发现这对许多项目都很重要），其中一个关键技能是知道如何评估你的代理工作流程。因此，在下一个视频中，我们将讨论评估或评价及其关键组成部分，如何构建并持续改进你的工作流程，以获得你想要的性能。我们将在下一个视频中讨论评价。

## 7、Evaluation agentic AI

我曾与多个团队合作构建自动化工作流程，发现决定一个人能否高效完成工作的关键因素，在于其能否推动严谨的评估流程。因此，推动自动化流程评估的能力，将极大影响你构建这些流程的实际成效。

在本视频中，我们将快速概述如何构建评估，这实际上是我们将在本课程后续模块中深入探讨的主题。那么，让我们开始吧。在构建了像这样的代理工作流程来处理客户订单查询后，事实证明，很难提前知道哪些环节可能会出错。因此，与其试图提前构建评估，我建议你直接查看输出结果，并手动寻找你希望它做得更好的地方。

例如，也许你阅读了大量输出内容，发现其中意外地过多提及了竞争对手。许多企业不希望其代理提及竞争对手，因为这只会造成尴尬局面。如果你仔细阅读这些输出内容，可能会发现有时它会说："很高兴您选择在我们这里购物。我们比竞争对手 ComproCo 强多了。"或者有时会说："当然，应该会很有趣。"

与 RivalCo 不同，我们让退货变得简单。你可能会看着这个例子说，哎呀，我真的不想提到竞争对手。这正是一个在构建这种自主工作流程前很难预见的问题范例。因此，最佳实践确实是先构建系统，然后检查它，找出尚不令人满意的地方，接着找到评估和改进系统的方法，以消除那些仍然不尽如人意的方面。

假设您的企业认为以这种方式提及竞争对手是一种错误或失误，那么在您努力消除这些提及竞争对手的内容时，一种跟踪进展的方法是添加一个评估或评价，以跟踪这种错误发生的频率。因此，如果您有一个列出的竞争对手名单，如 ComproCo、RivalCo、其他公司等，那么您实际上可以编写代码，只需在自己的输出中搜索这些竞争对手名称被提及的频率，并将其作为一个数字、作为整体响应的一部分来计算错误提及竞争对手的频率。

关于竞争对手提及问题的一个好处是，它是一个客观指标，意味着要么提到了竞争对手，要么没有。对于客观标准，你可以编写代码来检查这种特定错误发生的频率。但由于大语言模型输出的是自由文本，也会有一些标准用于评估这些输出，这些标准可能更主观，很难简单地编写代码来输出一个非黑即白的分数。

在这种情况下，使用大语言模型（LLM）作为评判工具是一种常见的评估输出质量的技术。例如，如果你正在构建一个研究代理来对不同主题进行研究，那么你可以使用另一个 LLM，并提示它给以下文章打一个 1 到 5 分的质量评分，其中 1 分是最差，5 分是最好。在这里，我用 Python 表达式来表示将生成的文章复制粘贴到这里。

因此，你可以提示大语言模型阅读论文并为其评定质量分数。接下来，我会要求研究代理撰写多份不同的研究报告，例如关于黑洞科学的最新进展或使用机器人采摘水果的报告。在这个例子中，或许评审大语言模型会给关于黑洞的论文打 3 分，关于机器人采摘的论文打 4 分。随着你不断改进研究代理，希望这些分数会随着时间的推移而提高。

顺便说一句，事实证明，大语言模型（LLMs）在 1 到 5 分的评分标准上其实并不太擅长。你可以尝试一下，但我个人不太常用这种方法。不过，在后面的模块中，你会学到一些更好的技巧，让大语言模型输出更准确的分数，而不是简单地要求它在 1 到 5 分的范围内打分。虽然有些人可能会这样做，也许作为一种初步筛选，把大语言模型当作评判工具来使用。

先给大家预览一下本课程后续会讲到的几种自主 AI 评估方法。你们已经听我讲过如何编写代码来评估客观标准，比如是否提及了竞争对手；或者使用大语言模型作为评判者来评估更主观的标准，比如这篇论文的质量如何。但后续你们还会学习到两种主要的评估类型。

一种是端到端的评估，即衡量整个智能体的输出质量；另一种是组件级别的评估，即衡量智能体工作流程中单个步骤的输出质量。事实证明，这两种评估方式对于推动开发过程的不同部分都非常有用。

我经常做的另一件事是检查中间输出，有时我们称之为大语言模型的运行轨迹，以了解它在哪些方面未能达到我的期望。我们称之为错误分析，即仔细阅读每个步骤的中间输出，试图找出改进的机会。

事实证明，能够进行评估和错误分析是一项非常关键的技能。在本课程的第四个模块中，我们将对此进行更详细的讨论。我们即将完成第一个模块的学习。在继续之前，我想与大家分享我认为构建代理工作流最重要的设计模式。让我们在下一个视频中一起探讨。

## 8、Agentic design patterns

我们通过选取基础构建模块并将它们组合起来，构建出这些复杂的工作流程。在本视频中，我想与大家分享几个关键的设计模式，这些模式可以帮助你思考如何将这些基础模块组合成更复杂的工作流程。让我们一起来看看。我认为构建自主工作流程的四个关键设计模式是：反思、工具用途、规划以及多智能体协作。

让我简要概述一下它们的含义，然后我们还会深入探讨其中大部分内容。第一个主要设计模式是反思。比如，我可能会向一个 LLM 代理请求编写代码，结 果LLM 可能会生成这样的代码。这里定义了一个 Python 函数来执行特定任务。然后，我可以构造一个像这样的提示。

我可以说，这段代码是为了完成某项任务而编写的，然后将 LLM 刚刚输出的内容复制粘贴回这个提示中。接着，我会要求它仔细检查代码的正确性、风格和效率，并给出建设性的批评意见。事实证明，同一个 LLM 模型通过这种方式提示，可能会指出代码中的一些问题。然后，如果我把这些批评意见反馈给模型，说看起来这是个 bug，你能修改代码来修复它吗？

那么它实际上可能会带来一个更好的代码版本。为了预览工具的使用，如果你能运行代码并查看代码失败的地方，然后将这些反馈给大语言模型，也可以让它进行迭代并生成一个更好的版本，比如代码的 v3 版本。因此，反思是一种常见的设计模式，你可以要求大语言模型检查自己的输出，或者引入一些外部信息源，比如运行代码并查看是否生成任何错误消息，并以此作为反馈再次迭代，从而得出一个更好的输出版本。

这种设计模式并非魔法。它并不能保证每次都能百分百奏效。但有时确实能为系统性能带来显著提升。虽然我画的是向单个大语言模型（LLM）发送提示的场景，但为了铺垫多智能体工作流的概念，你可以想象用评审智能体代替自我评审的设定。这个评审智能体本质上就是被赋予特定指令的 LLM，比如"你的角色是代码评审员，这是为实现某功能编写的代码，请仔细检查代码"这类提示词。

第二位批评代理可能会指出错误或运行单元测试。通过设置两个模拟代理，每个代理都只是一个被提示扮演特定角色的 LLM，你可以让它们来回互动以迭代获得更好的输出。除了反思模式外，第二个重要的设计模式是工具使用。如今，LLM 可以被赋予工具，即它们可以调用的函数来完成工作。例如，如果你问一个 LLM，根据评论者，最好的咖啡机是什么，并给它一个网络搜索工具，那么它实际上可以搜索互联网以找到更好的答案。

或者是一个代码执行工具。如果你问一个数学问题，比如，如果我投资 100 美元复利，最后能得到多少？它就可以编写并执行代码来计算答案。如今，不同的开发者已经为 LLM 提供了许多不同的工具，从数学或数据分析，到通过从网络获取信息或各种数据库来收集信息，再到与电子邮件、日历等生产力应用交互，以及处理图像等等。

而大语言模型能够决定使用哪些工具，即调用哪些函数，这使得模型能够完成更多任务。四个设计模式中的第三个是规划。这是来自一篇名为 Hugging GPT 的论文中的例子，如果你要求系统生成一张女孩正在读书且姿势与图片中男孩相同的图像，然后用你的声音描述这张新图像。

然后，模型可以自动决定执行此任务所需的步骤：首先需要找到一个姿势识别模型来确定男孩的姿势，接着调整图像姿势、生成女孩的图片并添加文字，最后将文字转为语音。在规划过程中，大语言模型会判断需要采取哪些行动序列。在本例中，这体现为一系列 API 调用的顺序，从而确保以正确的步骤顺序执行任务。

因此，开发者无需预先硬编码步骤序列，而是让大语言模型自行决定采取哪些步骤。目前具备规划能力的智能体更难控制且更具实验性，但有时能带来令人惊喜的结果。最后是多智能体工作流——就像人类经理会组建团队合作完成复杂项目那样，在某些情况下，你可以部署一组各有所长的智能体，让它们协同完成复杂任务。

左侧这张图片来自一个名为 ChatDev 的项目，该项目是由陈谦及其合作者创建的一个软件框架。在 ChatDev 中，多个具有不同角色的智能体，如首席执行官、程序员、测试员、设计师等，像一个虚拟软件公司一样协同工作，能够共同完成一系列软件开发任务。我们再来看另一个例子。

如果你想写一份营销手册，可能会考虑雇佣一个三人团队，比如一名研究员负责在线调研，一名营销人员撰写营销文案，最后还有一名编辑负责润色文本。同样地，你也可以考虑构建一个多智能体工作流，其中包含模拟的研究智能体、模拟的营销智能体和模拟的编辑智能体，它们共同协作为你完成这项任务。

多智能体工作流更难控制，因为你无法提前预知智能体的行为，但研究表明，这类工作流能在许多复杂任务中取得更好的成果，例如撰写人物传记或决定国际象棋中的走棋策略。在本课程后续内容中，你还会深入学习多智能体工作流。希望通过这些讲解，你能对智能工作流的功能有所了解，同时也认识到寻找构建模块并通过设计模式将其组合起来以实现智能工作流所面临的主要挑战。

当然，我们也在不断改进评估系统，以便你能清楚地看到系统的表现并持续优化。在下一个模块中，我将带大家深入探讨第一个设计模式——反思（reflection）。你会发现，这个看似简单的实现技巧，有时能为系统性能带来显著的提升。现在，让我们进入下一模块，一起学习反思设计模式。


